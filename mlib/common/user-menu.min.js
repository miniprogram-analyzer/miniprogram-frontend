function AppendUserMenuHtml() {
    var n = '<div class="user-menu hide" role="region"><div class="user-menu-sdk-mask"><\/div><div class="user-menu-box hide"><div class="um">';
    n += '<div class="user-head"><div class="head-img"><img alt="头像" src="/img/blank.png" class="head-avatar" width="65" height="65"/><\/div><div class="user-info"><span class="user-nick" role="button"><\/span><p><\/p><\/div><\/div>';
    n += '<div class="user-content" onselectstart="return false" role="menu"><!--<a href="' + Domain.WapDomain + '/user/usercomment" class="user-focus"><div class="user-column my-comment"><span role="button">我的评论<\/span><\/div><\/a><a href="' + Domain.QuanDomain + '/user/usertie"><div class="user-column my-tie"><span role="button">我的帖子<\/span><\/div><\/a><a href="' + Domain.WapDomain + '/user/usercollect"><div class="user-column my-collect"><span role="button">我的收藏<\/span><\/div><\/a><div class="user-column share-to-fr"><span role="button">分享给好友<\/span><\/div>--><div class="user-column light-dark-set"><span role="button"><i class="auto">跟随系统<\/i> | <i class="light">明亮<\/i> | <i class="dark">黑暗<\/i><\/span><\/div><!--<div class="user-column user-set"><span role="button">账户设置<\/span><\/div><div class="user-column user-feed-back"><span role="button">意见反馈<\/span><\/div>--><div class="user-column user-logout hide"><span role="button">退出登录<\/span><\/div><\/div>';
    n += "<\/div><\/div><\/div>";
    $("body").append(n)
    var username = window.localStorage.getItem("username")
    var id = window.localStorage.getItem("id")
    var loginStatus = false
    const verification_pages = ["/asking", "/mobile/asking.html"]
    const verification_id = ['#submit']
    const verification_operation = ['<a href="javascript:;" class="answer_inpt" id="btnSubmit">提交</a>']
    const unauthorizedHandler = function (){
        ($(".user-menu .user-head").attr("data-login-type", "nologin"), $(".user-menu .user-head .user-info .user-nick").text("登录/注册"), $(".user-menu .user-head .user-info p").html("登录到试剑亭，记录成长点滴"))
        if(verification_pages.includes(location.pathname)){
            window.location.href = "/login?source=" + location.pathname + location.search + (window.localStorage.getItem("LightDarkSet") === "dark" ? "&night=1" : window.localStorage.getItem("LightDarkSet") === "light" ? "&night=0" : "")
        }
    }
    if (id !== undefined && id !== null) {
        $.ajax({
            type: 'POST',
            url: api_getUserinfo,
            data: {
                id: id
            },
            crossDomain: true,
            xhrFields: {
                withCredentials: true
            },
            success: function (res) {
                if(res.successFlag == "Y"){
                    $(".user-menu .user-head .user-info .user-nick").text(username)
                    $(".user-menu .user-head .user-info p").html(id)
                    $(".user-menu .user-content .user-column.user-logout").show()
                    loginStatus = true
                    if(verification_pages.includes(location.pathname)){
                        var idx = Math.floor(verification_pages.indexOf(location.pathname) / 2)
                        $(verification_id[idx]).html(verification_operation[idx]);
                    }
                }
                else {
                    window.localStorage.removeItem("username")
                    window.localStorage.removeItem("id")
                    unauthorizedHandler();
                }
            },
            error: function (err) {
                window.localStorage.removeItem("username")
                window.localStorage.removeItem("id")
                unauthorizedHandler();
            }
        });
    }
    else {
        unauthorizedHandler();
    }
}
$(function () {
    var t, n;
    if (AppendUserMenuHtml(), t = localStorage.getItem("BSSwitchTip"), t !== "noTip") {
        $(".index-box").append('<div class="bs-switchs-tip-box"><div id="bs-switchs-tip"><\/div><\/div>');
        LoadJs(Domain.WapJsDomain + "/common/lottie.min.js", function () {
            lottie.loadAnimation({
                container: document.getElementById("bs-switchs-tip"),
                renderer: "svg",
                loop: !0,
                autoplay: !0,
                path: "images/ae/bs-switch-tip.json"
            })
        });
        setTimeout(function () {
            localStorage.setItem("BSSwitchTip", "noTip");
            $(".bs-switchs-tip-box").remove()
        }, 3700);
        $(document).on("click touchmove", ".bs-switchs-tip-box #bs-switchs-tip", function () {
            $(".bs-switchs-tip-box .bs-switchs-tip-mask").remove();
            localStorage.setItem("BSSwitchTip", "noTip");
            $(".bs-switchs-tip-box").remove();
            $(".head .hd .brand-column-user-btn").click()
        })
    }
    switch (window.localStorage.getItem("LightDarkSet")) {
        case "light":
            $(".user-menu .user-content .user-column.light-dark-set i.light").addClass("active");
            break;
        case "dark":
            $(".user-menu .user-content .user-column.light-dark-set i.dark").addClass("active");
            break;
        case "auto":
        default:
            $(".user-menu .user-content .user-column.light-dark-set i.auto").addClass("active")
    }
    switch (window.localStorage.getItem("PageBsType")) {
        case "b-speedy":
            $(".user-menu .user-page-type .page-type-box .speedy").addClass("active");
            break;
        default:
            $(".user-menu .user-page-type .page-type-box .t-screen").addClass("active")
    }
    $(document).on("click", ".head .hd .brand-column-user-btn", function () {
        /*userInfo !== null && userInfo !== "" && userInfo !== undefined ? ($(".user-menu .user-head").attr("data-login-type", ""), $(".user-menu .user-head .head-img img").attr({
            src: userInfo.UserAvatarHeadImg
        }), !!userInfo.UserMesClass && !!userInfo.Vipendtime && ParseDate(userInfo.Vipendtime) >= new Date && $(".user-menu .user-head .user-info").addClass(userInfo.UserMesClass), $(".user-menu .user-head .user-info .user-nick").text(userInfo.UserNick), $(".user-menu .user-head .user-info p").html("<span>Lv." + userInfo.Level + "<\/span>&nbsp;&nbsp;&nbsp;<span>ID:" + userInfo.UserID + "<\/span>"), $(".user-menu .user-content .user-column.user-logout").show()) : ($(".user-menu .user-head").attr("data-login-type", "nologin"), $(".user-menu .user-head .user-info .user-nick").text("登录/注册"), $(".user-menu .user-head .user-info p").html("登录到试剑亭，记录成长点滴"));*/
        $(".user-menu").show();
        $(".user-menu .user-menu-box").show().animate({
            right: 0
        }, 370, function () {
            $(".user-menu .user-content .user-focus").focus()
        })
    });
    $(document).on("click", ".user-menu .user-menu-sdk-mask,.user-menu .user-content .user-column", function () {
        $(".user-menu .user-menu-box").animate({
            right: "-80%"
        }, 370, function () {
            $(".user-menu").hide()
        })
    });
    $(document).on("click", ".user-menu .user-head[data-login-type='nologin']", function () {
        LoginWindow()
    });
    $(document).on("click", ".user-menu .user-content .share-to-fr", function () {
        NShareSet("", Domain.WapDomain, "", "IT之家，软媒旗下科技门户网站 - 爱科技，爱这里。", "");
        NShareCall()
    });
    n = !1;
    $(document).on("click", ".user-menu .user-content .user-logout", function () {
        $.ajax({
            type: 'POST',
            url: api_loginOut,
            success: function (res) {
                console.log(res)
                window.localStorage.removeItem("username")
                window.localStorage.removeItem("id")
                location.reload()
            },
            error: function (err) {
                console.log(err)
                location.reload()
            }
        });
    });
    $(document).on("click", ".user-menu .user-content .user-column.light-dark-set i", function () {
        $(".user-menu .user-content .user-column.light-dark-set i").removeClass("active");
        $(this).addClass("active");
        $(this).hasClass("light") ? (window.localStorage.setItem("LightDarkSet", "light"), $("html").addClass("light"), $("html").removeClass("dark"), $("#pdf-course").attr("src","/utils/pdfjs-2.6.347/web/viewer-es5.html?file=/attachment/%E8%8F%9C%E9%B8%9F%E6%95%99%E7%A8%8B.pdf?night=0"))  : $(this).hasClass("dark") ? (window.localStorage.setItem("LightDarkSet", "dark"), $("html").addClass("dark"), $("html").removeClass("light"), $("#pdf-course").attr("src","/utils/pdfjs-2.6.347/web/viewer-es5.html?file=/attachment/%E8%8F%9C%E9%B8%9F%E6%95%99%E7%A8%8B.pdf?night=1")) : (window.localStorage.setItem("LightDarkSet", "auto"), $("html").removeClass("light"), $("html").removeClass("dark"), $("#pdf-course").attr("src","/utils/pdfjs-2.6.347/web/viewer-es5.html?file=/attachment/%E8%8F%9C%E9%B8%9F%E6%95%99%E7%A8%8B.pdf"))
    });
    $(document).on("click", ".user-menu .user-page-type .page-type-box span", function () {
        $(".user-menu .user-page-type .page-type-box span").removeClass("active");
        $(this).addClass("active");
        var n = new Date;
        $(this).hasClass("t-screen") ? (window.localStorage.setItem("PageBsType", "blog"), window.location.href.match(Domain.WapDomain + "/html/") ? window.location.href = Domain.WapDomain : ($(".banner .swiper-wrapper .swiper-lazy-bs").addClass("swiper-lazy"), $("body").removeClass("b-speedy"), $(".user-menu .user-menu-box").animate({
            right: "-85%"
        }, 370, function () {
            $(".user-menu").hide()
        }), LazyLoadConfigSet())) : $(this).hasClass("speedy") ? (window.localStorage.setItem("PageBsType", "b-speedy"), window.location.href.match(Domain.WapDomain + "/html/") ? window.location.href = Domain.WapDomain : ($(".user-menu .user-menu-box").animate({
            right: "-85%"
        }, 370, function () {
            $(".user-menu").hide()
        }), $("body").addClass("b-speedy"))) : $(this).hasClass("pc") && (n.setHours(n.getHours() + 24), document.cookie = "gotoweb=true;domain=.ithome.com;path=/;expires=" + n.toGMTString(), window.location.href = "https://www.ithome.com")
    });
    $(document).on("click", ".user-menu .head", function () {
        userInfo === null && LoginWindow(Domain.WapDomain)
    });
    $(document).on("click", ".user-menu .user-content .user-feed-back", function () {
        userInfo === null ? LoginWindow(Domain.WapDomain) : window.location.href = Domain.WapHtmlDomain + "/user/userfeedback.html"
    });
    $(document).on("click", ".user-menu .user-content .user-set", function () {
        userInfo === null ? LoginWindow(Domain.WapDomain) : window.location.href = "https://my.ruanmei.com/usercenter/base.aspx"
    })
});